# Рефлексия: Рефакторинг NavBar

## Проблема
В компоненте `NavBar.tsx` была обнаружена дублирование логики авторизации:
- Проверка `user ? ... : ...` повторялась в десктопной и мобильной версиях
- Логика авторизации была смешана с UI логикой
- Проверка авторизации происходила на уровне компонента низкого уровня

**Дополнительно**: В `GuestNav.tsx` и `AuthNav.tsx` было обнаружено большое дублирование кода:
- Одинаковая логика управления аккордеоном
- Дублирование мобильной и десктопной версий
- Повторяющиеся импорты и структура компонентов

## Решение

### Первый этап - Разделение ответственности:
1. Созданы отдельные компоненты:
   - `AuthNav.tsx` - для авторизованных пользователей
   - `GuestNav.tsx` - для неавторизованных пользователей

2. Упрощен NavBar:
   - Убрана логика авторизации
   - Стал простым контейнером, который получает пропсы
   - Определяет какой компонент показывать на основе `user`

3. Логика авторизации поднята в Header:
   - Header теперь содержит `useAuth` и `useRouter`
   - Обработчики `handleLogin` и `handleLogout` находятся в Header
   - NavBar получает необходимые пропсы от Header

### Второй этап - Устранение дублирования:
1. Создан хук `useAccordion`:
   - Вынесена логика управления состоянием аккордеона
   - Предоставляет `isOpen`, `accordionRef`, `toggle`, `close`
   - Переиспользуется в разных компонентах

2. Созданы общие компоненты:
   - `MobileNav.tsx` - общий компонент мобильной навигации
   - `DesktopNav.tsx` - общий компонент десктопной навигации

3. Упрощены AuthNav и GuestNav:
   - Убрано дублирование логики аккордеона
   - Убрано дублирование структуры мобильной/десктопной версий
   - Оставлена только специфичная логика для каждого типа пользователя

## Архитектурные улучшения:
- **Разделение ответственности**: UI логика отделена от бизнес-логики
- **Устранение дублирования**: Логика авторизации и аккордеона больше не дублируется
- **Правильный уровень абстракции**: Проверка авторизации происходит на уровне Header
- **Модульность**: Компоненты стали более специализированными
- **Переиспользование**: Общие компоненты и хуки можно использовать в других местах
- **DRY принцип**: Устранено дублирование кода

## Результат:
- Код стал более читаемым и поддерживаемым
- Устранено дублирование на всех уровнях
- Улучшена архитектура компонентов
- Созданы переиспользуемые компоненты и хуки
- Все тесты проходят
- Приложение собирается без ошибок

## Файлы изменены:
### Первый этап:
- `src/components/Header/AuthNav.tsx` (новый)
- `src/components/Header/GuestNav.tsx` (новый)
- `src/components/Header/NavBar.tsx` (рефакторинг)
- `src/components/Header/Header.tsx` (добавлена логика авторизации)
- `src/components/__tests__/Header.test.tsx` (обновлены тесты)

### Второй этап:
- `src/hooks/useAccordion.ts` (новый)
- `src/hooks/__tests__/useAccordion.test.ts` (новый)
- `src/components/Header/MobileNav.tsx` (новый)
- `src/components/Header/DesktopNav.tsx` (новый)
- `src/components/Header/AuthNav.tsx` (упрощен)
- `src/components/Header/GuestNav.tsx` (упрощен)
